<!-- create.cshtml -->

@model WebSAT.Models.ViewModels.FacturaViewModel
@{
    ViewData["Title"] = "Crear Factura";
}

<h2>Crear Factura</h2>

@using (Html.BeginForm("Create", "Facturas", FormMethod.Post, new { @class = "form-horizontal" }))
{
    <!-- Factura -->
    <div class="form-group">
        @Html.LabelFor(m => m.Version)
        @Html.TextBoxFor(m => m.Version, new { @class = "form-control", @readonly = "readonly" })
    </div>

    <div class="form-group"> 
        @Html.LabelFor(m => m.Serie) 
        @Html.TextBoxFor(m => m.Serie, new { @class = "form-control" }) 
    </div>

    <div class= "form-group">
        @Html.LabelFor(m => m.Folio)
        @Html.TextBoxFor(m => m.Folio, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Fecha) 
        @Html.TextBoxFor(m => m.Fecha, new { type = "date", @class = "form-control" }) 
    </div>

    <!-- Emisor -->

    @Html.HiddenFor(m => m.EmisorId)

    <div class="form-group"> 
        @Html.LabelFor(m => m.EmisorId) 
        @Html.DropDownListFor(m => m.EmisorId, new SelectList(ViewBag.Emisores, "Value", "Text"), "Seleccione un Emisor", new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Emisor.RFC)
        @Html.TextBoxFor(m => m.Emisor.RFC, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Emisor.Nombre)
        @Html.TextBoxFor(m => m.Emisor.Nombre, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Emisor.RegimenFiscal)
        @Html.TextBoxFor(m => m.Emisor.RegimenFiscal, new { @class = "form-control" })
    </div>

    <!-- Receptor -->

    @Html.HiddenFor(m => m.ReceptorId)

    <div class="form-group"> 
        @Html.LabelFor(m => m.ReceptorId) 
        @Html.DropDownListFor(m => m.ReceptorId, new SelectList(ViewBag.Emisores, "Value", "Text"), "Seleccione un Emisor", new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Receptor.RFC)
        @Html.TextBoxFor(m => m.Receptor.RFC, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Receptor.Nombre)
        @Html.TextBoxFor(m => m.Receptor.Nombre, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Receptor.UsoCFDI)
        @Html.TextBoxFor(m => m.Receptor.UsoCFDI, new { @class = "form-control" })
    </div>

    <!-- Complementos -->

    <div class="form-group">
        @Html.LabelFor(m => m.SubTotal)
        @Html.TextBoxFor(m => m.SubTotal, new { type = "number", step = "0.01", @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Moneda)
        @Html.TextBoxFor(m => m.Moneda, new { @class = "form-control", @readonly = "readonly" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Total)
        @Html.TextBoxFor(m => m.Total, new { type = "number", step = "0.01", @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.TipoDeComprobante)
        @Html.TextBoxFor(m => m.TipoDeComprobante, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.MetodoPago)
        @Html.DropDownListFor(m => m.MetodoPago, new SelectList(new[]
        {
            new SelectListItem { Text = "Efectivo", Value = "Efectivo" },
            new SelectListItem { Text = "Transferencia", Value = "Transferencia" },
            new SelectListItem { Text = "Tarjeta", Value = "Tarjeta" },
            new SelectListItem { Text = "Cheque", Value = "Cheque" }
        }, "Value", "Text"), "Seleccione un método de pago", new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.LugarExpedicion)
        @Html.TextBoxFor(m => m.LugarExpedicion, new { @class = "form-control" })
    </div>

    <!-- Lista de Conceptos -->
    <div class="form-group">
        <label class="control-label">Conceptos</label>
        @for (int i = 0; i < Model.Conceptos?.Count; i++)
        {
            <div class="concepto-item">
                @Html.TextBoxFor(m => m.Conceptos[i].ClaveProdServ, new { @class = "form-control", placeholder = "Clave Prod/Serv" })
                @Html.TextBoxFor(m => m.Conceptos[i].Cantidad, new { @class = "form-control", placeholder = "Cantidad" })
                @Html.TextBoxFor(m => m.Conceptos[i].ClaveUnidad, new { @class = "form-control", placeholder = "Clave Unidad" })
                @Html.TextBoxFor(m => m.Conceptos[i].Descripcion, new { @class = "form-control", placeholder = "Descripción" })
                @Html.TextBoxFor(m => m.Conceptos[i].ValorUnitario, new { @class = "form-control", placeholder = "Valor Unitario" })
                @Html.TextBoxFor(m => m.Conceptos[i].Importe, new { @class = "form-control", placeholder = "Importe" })
            </div>
        }
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-primary">Crear Factura</button>
        @Html.ActionLink("Volver a la lista de facturas", "Index", "Facturas", null, new { @class = "btn btn-secondary" })
    </div>
}